---
title: Write-Up ROOT ME
date: 2023-10-14 12:34:01 +0700
categories: [CTF, TryHackMe, Write-Up]
tags: [web, write-up, ctf]     # TAG names should always be lowercase
---
# ROOTME

- Truy cáº­p vÃ o trang web nhÆ° sau, sau khi F12 vÃ  khÃ´ng cÃ³ thÃ´ng tin gÃ¬ há»¯u Ã­ch, mÃ¬nh tiáº¿n hÃ nh scan xem thá»­ trang web cÃ³ directory áº©n nÃ o khÃ´ng.

<img src="/assets/writeup/cookie/ROOTME/Untitled.png">
payload scan: ffuf `-w common.txt -u http://10.10.178.152/FUZZ -fc 404 -fs 0`

<img src="/assets/writeup/cookie/ROOTME/Untitled 1.png">

- Sau khi scan xong mÃ¬nh phÃ¡t hiá»‡n `/panel` sáº½ dáº«n ta vÃ o 1 trang cÃ³ thá»ƒ upload

<img src="/assets/writeup/cookie/ROOTME/Untitled 2.png">

- MÃ¬nh cÃ³ thá»­ up file .php lÃªn tuy nhiÃªn cÃ³ váº» nhÆ° trang web khÃ´ng cho phÃ©p Ä‘uÃ´i cÃ³ dáº¡ng lÃ  .php, tháº¿ nÃªn mÃ¬nh thá»­ Ä‘á»•i sang Ä‘á»‹nh dáº¡ng khÃ¡c lÃ  php5 thÃ¬ bypass Ä‘Æ°á»£c filter âœŒğŸ¼
- MÃ¬nh up file shell.phtml cÃ³ ná»™i dung nhÆ° sau:

<img src="/assets/writeup/cookie/ROOTME/Untitled 3.png">

<img src="/assets/writeup/cookie/ROOTME/Untitled 4.png">

- Truy cáº­p vÃ o Ä‘Æ°á»ng dáº«n upload vÃ  test

<img src="/assets/writeup/cookie/ROOTME/Untitled 5.png">

- Sau khi cháº¡y shell thÃ nh cÃ´ng, mÃ¬nh tiáº¿n hÃ nh tÃ¬m flag Ä‘áº§u tiÃªn

<img src="/assets/writeup/cookie/ROOTME/Untitled 6.png">

Chi tiáº¿t hÆ¡n vá» lá»‡nh nÃ y: `?cmd=find / -name user.txt 2>/dev/null`

- **`find`**: Lá»‡nh dÃ¹ng Ä‘á»ƒ tÃ¬m kiáº¿m tá»‡p vÃ  thÆ° má»¥c trong cáº¥u trÃºc thÆ° má»¥c.
- **`/`**: ThÆ° má»¥c gá»‘c, nÆ¡i báº¯t Ä‘áº§u tÃ¬m kiáº¿m.
- **`name user.txt`**: TÃ¹y chá»n cho biáº¿t cáº§n tÃ¬m kiáº¿m cÃ¡c tá»‡p cÃ³ tÃªn lÃ  "user.txt".
- **`2>/dev/null`**: HÆ°á»›ng dáº«n há»‡ thá»‘ng Ä‘á»ƒ áº©n Ä‘i báº¥t ká»³ lá»—i nÃ o xuáº¥t hiá»‡n trong quÃ¡ trÃ¬nh tÃ¬m kiáº¿m. TÃ¹y chá»n **`2>`** chuyá»ƒn hÆ°á»›ng lá»—i (stderr) vÃ  **`/dev/null`** lÃ  nÆ¡i cÃ¡c lá»—i Ä‘Æ°á»£c gá»­i Ä‘áº¿n vÃ  bá»‹ loáº¡i bá».

NhÆ° váº­y, lá»‡nh nÃ y tÃ¬m kiáº¿m táº¥t cáº£ cÃ¡c tá»‡p cÃ³ tÃªn lÃ  "user.txt" tá»« thÆ° má»¥c gá»‘c vÃ  cÃ¡c thÆ° má»¥c con, vÃ  khÃ´ng hiá»ƒn thá»‹ báº¥t ká»³ thÃ´ng bÃ¡o lá»—i nÃ o náº¿u cÃ³.

- Sau khi biáº¿t Ä‘Æ°á»£c vÃ­ trÃ­ cá»§a user.txt, ta tiáº¿n hÃ nh Ä‘á»c thui

<img src="/assets/writeup/cookie/ROOTME/Untitled 7.png">

- á» flag tiáº¿p theo, ta pháº£i sá»­ dá»¥ng reverse shell Ä‘á»ƒ lÃ m, vÃ¬ tháº¿ mÃ¬nh tiáº¿n hÃ nh up file rev shell lÃªn há»‡ thá»‘ng. CÃ¡c báº¡n cÃ³ thá»ƒ search gg key â€œ reverse shell â€œ

<img src="/assets/writeup/cookie/ROOTME/Untitled 8.png">

- Sau khi káº¿t ná»‘i vÃ o Ä‘Æ°á»£c shell

<img src="/assets/writeup/cookie/ROOTME/Untitled 9.png">

- Äá»ƒ tÃ¬m kiáº¿m cÃ¡c tá»‡p cÃ³ quyá»n SUID (Set user ID) trong Linux, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng lá»‡nh find nhÆ° sau: `find / -perm -4000 -type f -print`

CÃ¡ch hoáº¡t Ä‘á»™ng:

- `find:` lá»‡nh Ä‘á»ƒ tÃ¬m kiáº¿m cÃ¡c tá»‡p trong há»‡ thá»‘ng
- `/:` báº¯t Ä‘áº§u tÃ¬m kiáº¿m tá»« thÆ° má»¥c gá»‘c
- `-perm -4000`: tÃ¬m cÃ¡c tá»‡p cÃ³ quyá»n tá»©c lÃ  cÃ³ bit SUID Ä‘Æ°á»£c báº­t
- `-type f`: chá»‰ tÃ¬m cÃ¡c tá»‡p thÃ´ng thÆ°á»ng, khÃ´ng pháº£i thÆ° má»¥c
- `-print`: in ra Ä‘Æ°á»ng dáº«n cÃ¡c tá»‡p tÃ¬m tháº¥y
- Sau khi tÃ¬m kiáº¿m, mÃ¬nh phÃ¡t hiá»‡n thÆ° má»¥c `/usr/bin/python` , thÆ° má»¥c nÃ y nguy hiá»ƒm vÃ  khÃ´ng nÃªn Ä‘Æ°á»£c cáº¥p quyá»n SUID vÃ¬ nÃ³ cho phÃ©p ngÆ°á»i dÃ¹ng thÆ°á»ng cÃ³ thá»ƒ cháº¡y cÃ¡c tá»‡p python vá»›i quyá»n root. Äiá»u nÃ y ráº¥t nguy hiá»ƒm vÃ¬ hacker cÃ³ thá»ƒ táº¡o má»™t script Python Ä‘á»™c háº¡i vÃ  cháº¡y nÃ³ vá»›i Ä‘áº·c quyá»n cao, cÃ³ kháº£ nÄƒng lÃ m há»ng há»‡ thá»‘ng hoáº·c Ä‘Ã¡nh cáº¯p dá»¯ liá»‡u nháº¡y cáº£m.

<img src="/assets/writeup/cookie/ROOTME/Untitled 10.png">

- MÃ¬nh sá»­ dá»¥ng payload sau: `python -c 'import os; os.execl("/bin/sh", "sh", "-p")â€™`
1. **`python`**: ÄÃ¢y lÃ  lá»‡nh Ä‘á»ƒ cháº¡y má»™t chÆ°Æ¡ng trÃ¬nh Python tá»« dÃ²ng lá»‡nh.
2. **`c 'import os; os.execl("/bin/sh", "sh", "-p")'`**: ÄÃ¢y lÃ  cá» **`c`** cá»§a Python, cho phÃ©p báº¡n cháº¡y má»™t Ä‘oáº¡n mÃ£ Python ngáº¯n tá»« dÃ²ng lá»‡nh.
    
    Trong Ä‘oáº¡n mÃ£ Python Ä‘Æ°á»£c thá»±c thi cÃ³ hai pháº§n chÃ­nh:
    
    - **`import os`**: ÄÃ¢y lÃ  lá»‡nh Python Ä‘á»ƒ nháº­p thÆ° viá»‡n **`os`**, giÃºp báº¡n tÆ°Æ¡ng tÃ¡c vá»›i há»‡ Ä‘iá»u hÃ nh.
    - **`os.execl("/bin/sh", "sh", "-p")`**: ÄÃ¢y lÃ  lá»‡nh sá»­ dá»¥ng hÃ m **`execl()`** trong thÆ° viá»‡n **`os`** Ä‘á»ƒ thá»±c thi chÆ°Æ¡ng trÃ¬nh **`/bin/sh`** (má»™t báº£n dá»‹ch cá»§a shell Unix) vá»›i cá» **`p`**. Cá» **`p`** trong trÆ°á»ng há»£p nÃ y sá»­ dá»¥ng cháº¿ Ä‘á»™ báº£o vá»‡, giá»¯ cÃ¡c biáº¿n mÃ´i trÆ°á»ng hiá»‡n táº¡i cá»§a shell.
    
<img src="/assets/writeup/cookie/ROOTME/Untitled 11.png">
    
- Tiáº¿p Ä‘Ã³ mÃ¬nh dÃ¹ng `find / -name '*.txt' 2>/dev/null`
- **`find`**: Lá»‡nh tÃ¬m kiáº¿m cÃ¡c tá»‡p vÃ  thÆ° má»¥c trong cáº¥u trÃºc thÆ° má»¥c.
- **`/`**: ThÆ° má»¥c gá»‘c, nÆ¡i báº¯t Ä‘áº§u tÃ¬m kiáº¿m.
- **`name '*.txt'`**: TÃ¹y chá»n Ä‘á»ƒ tÃ¬m kiáº¿m cÃ¡c tá»‡p cÃ³ pháº§n má»Ÿ rá»™ng lÃ  ".txt".

<img src="/assets/writeup/cookie/ROOTME/Untitled 12.png">

- Sau khi phÃ¡t hiá»‡n, mÃ¬nh chá»‰ cáº§n cat Ä‘á»ƒ Ä‘á»c file lÃ  xong

<img src="/assets/writeup/cookie/ROOTME/Untitled 13.png">
